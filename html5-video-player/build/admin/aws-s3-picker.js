(()=>{"use strict";var l;(l=jQuery)(document).ready(function(){const i=new e;l(".aws_video_picker").parent().on("click",function(){i.picker("",".h5vp_video_link")}),l(".aws_thumbnails_picker").parent().on("click",function(){i.picker("",".h5vp_video_thumbnails")})});class e{constructor(){this.allFolderFiles="",this.fileUrl="",this.openFileUrl="",this.rootFiles=[],this.setOn="";let l=jQuery,e=this,i=document.createElement("audio");i.setAttribute("src","https://bplugins.com/wp-content/uploads/2019/10/error.mp3"),this.pickerHTML(),l(document).on("click","li.root a",function(e){e.preventDefault(),l(this).parent().find("ul.child_2").slideToggle()}),l(document).on("click","li.child_1 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_3").slideToggle()}),l(document).on("click","li.child_2 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_4").slideToggle()}),l(document).on("click","li.child_3 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_5").slideToggle()}),l(document).on("click","li.child_4 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_6").slideToggle()}),l(document).on("click","li.child_5 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_7").slideToggle()}),l(document).on("click","li.child_6 a",function(e){e.preventDefault(),l(this).parent().find("ul.child_8").slideToggle()}),l(document).on("click","li.folderref a",function(){let i=l(this).parent().attr("folderref"),s=l(this).parent().attr("limit");l("li.folderref a").removeClass("active"),l("li.aws_file_name a").removeClass("active"),l(".aws_body .root_folder").removeClass("active"),l(this).addClass("active"),e.openFileUrl="",l(".aws_footer button").css("cursor","not-allowed"),e.setFiles(e.allFolderFiles,i,parseInt(s))}),l(document).on("dblclick","li.aws_file_name a",function(){l(".preview_panel .preview").remove(),l(".aws_popup_overlay").css("z-index","9999999999"),l(".preview_panel").show();let i=e.openFileUrl.split("/");i=i[i.length-1];let s=e.getOpener(i);"audio"==s?l(".preview_panel").append('<div class="preview"><audio class="preview_media" controls><source src="'+e.openFileUrl+'" ></audio></div>'):"image"==s?l(".preview_panel").append('<div class="preview"><img src="'+e.openFileUrl+'"/></div>'):"video"==s&&l(".preview_panel").append('<div class="preview"><video class="preview_media" controls><source src="'+e.openFileUrl+'" ></video></div>')}),l(document).on("click",".preview_close",function(){let e=document.querySelector(".preview_media");null!=e&&e.pause(),l(".aws_popup_overlay").css("z-index","9999999"),l(".preview_panel").hide()}),l(document).on("click","li.aws_file_name a",function(i){i.preventDefault(),l("li.aws_file_name a").removeClass("active"),l(this).addClass("active"),l(".aws_footer button").css("cursor","pointer"),e.openFileUrl=l(this).parent().attr("fileref")}),l(document).on("click",".aws_body .root_folder",function(i){i.preventDefault(),l(".aws_file_list ul li").remove(),l("li.folderref a").removeClass("active"),l("li.aws_file_name a").removeClass("active"),l(this).addClass("active"),e.openFileUrl="",l(".aws_footer button").css("cursor","not-allowed"),l(".aws_file_list ul").append(e.rootFiles)}),l(document).on("click",".aws_file_manager_popup .close",function(){l(".aws_file_manager_popup").slideUp("slow"),l(".aws_popup_overlay").fadeOut("slow"),l(".aws_loading").hide()}),l(document).on("click",".aws_footer button",function(s){s.preventDefault(),""==e.openFileUrl?(l(".aws_file_manager_popup").css({"animation-name":"aws_file_manager_error"}),i.play(),setTimeout(()=>{l(".aws_file_manager_popup").css({"animation-name":""})},1500)):(l(".aws_file_manager_popup").slideUp("slow"),l(".aws_popup_overlay").fadeOut("slow"),l(e.setOn).val(e.openFileUrl))})}retriveData(){let l=this,e=jQuery;e(".aws_file_manager_popup").slideDown("slow"),e(".aws_popup_overlay").fadeIn("slow"),Array.isArray(this.allFolderFiles)||(e(".aws_loading").fadeIn("slow"),e.post(window.ajax.ajax_url,{action:"h5vp_aws_picker"},function(i){if(e(".aws_loading").fadeOut("slow"),'"AWS S3 Client not found"'===i.data&&alert('Please install "bPlugins AWS S3 Extension"'),"false"==i)return e(".aws_file_list ul li").remove(),void e(".aws_file_list ul").append("<li>Please Set all required Information from settings menu. Thank you</li>");let s=i.data,a=s.lists;l.allFolderFiles=a;let t=a.length,o=[],n=[],r=[],d=[];l.fileUrl="https://"+s.bucketName+".s3."+s.region+".amazonaws.com/";for(let i=0;i<t;i++){let s=a[i].split("/");if(1==s.length){let s=l.getIcon(a[i]);l.rootFiles.push('<li class="aws_file_name" fileref="'+l.fileUrl+a[i]+'"><a href="#">'+s+" "+a[i]+"</a></li>"),e(".aws_file_list ul").append('<li class="aws_file_name" fileref="'+l.fileUrl+a[i]+'"><a href="#">'+s+" "+a[i]+"</a></li>")}else-1===o.indexOf(s[0])&&(o.push(s[0]),e(".aws_folder_list ul.root_folder_list").append('<li limit="1" class="folderref root" child="'+s[0]+'" folderref="'+s[0]+'/"><a href="#"><span>&#x1F4C1; </span>'+s[0]+'</a><ul class="child_2"></ul></li>')),3==s.length&&-1===n.indexOf(s[1])&&(n.push(s[1]),e(".aws_folder_list ul.root_folder_list li[child='"+s[0]+"'] ul.child_2").append('<li limit="2" class="folderref child_1" folderref="'+s[0]+"/"+s[1]+'/" child="'+s[1]+'"><a href="#"><span>&#x1F4C1; </span>'+s[1]+'</a><ul class="child_3"></ul></li>')),4==s.length&&-1===r.indexOf(s[2])&&(r.push(s[2]),e(".aws_folder_list ul.root_folder_list li[child='"+s[1]+"'] ul.child_3").append('<li limit="3" class="folderref child_2" folderref="'+s[0]+"/"+s[1]+"/"+s[2]+'/" child="'+s[2]+'"><a href="#"><span>&#x1F4C1; </span>'+s[2]+'</a><ul class="child_4"></ul></li>')),5==s.length&&-1===d.indexOf(s[3])&&(d.push(s[3]),e(".aws_folder_list ul.root_folder_list li[child='"+s[2]+"'] ul.child_4").append('<li limit="4" class="folderref child_3" folderref="'+s[0]+"/"+s[1]+"/"+s[2]+"/"+s[3]+'/" child="'+s[3]+'"><a href="#"><span>&#x1F4C1; </span>'+s[3]+'</a><ul class="child_5"></ul></li>')),6==s.length&&-1===d.indexOf(s[4])&&(d.push(s[4]),e(".aws_folder_list ul.root_folder_list li[child='"+s[3]+"'] ul.child_5").append('<li limit="5" class="folderref child_4" folderref="'+s[0]+"/"+s[1]+"/"+s[2]+"/"+s[3]+"/"+s[4]+'/" child="'+s[4]+'"><a href="#"><span>&#x1F4C1; </span>'+s[4]+'</a><ul class="child_6"></ul></li>')),7==s.length&&-1===d.indexOf(s[5])&&(d.push(s[5]),e(".aws_folder_list ul.root_folder_list li[child='"+s[4]+"'] ul.child_6").append('<li limit="6" class="folderref child_5" folderref="'+s[0]+"/"+s[1]+"/"+s[2]+"/"+s[3]+"/"+s[4]+"/"+s[5]+'/" child="'+s[5]+'"><a href="#"><span>&#x1F4C1; </span>'+s[5]+'</a><ul class="child_7"></ul></li>')),8==s.length&&-1===d.indexOf(s[6])&&(d.push(s[6]),e(".aws_folder_list ul.root_folder_list li[child='"+s[5]+"'] ul.child_7").append('<li limit="7" class="folderref child_5" folderref="'+s[0]+"/"+s[1]+"/"+s[2]+"/"+s[3]+"/"+s[4]+"/"+s[5]+"/"+s[6]+'/" child="'+s[6]+'"><a href="#"><span>&#x1F4C1; </span>'+s[6]+'</a><ul class="child_8"></ul></li>'))}""==e(".aws_folder_list ul").html()&&(e(".aws_folder_list ul").append([]),e(".aws_file_list ul").append([]))}))}setFiles(l,e,i=1){let s=jQuery,a=this;s(".aws_file_list ul li").remove();let t=0;l.map(l=>{l=(l=l.replace(/\)/g,"")).replace(/\(/g,"");let o=e.replace(/\)/g,"");if(o=o.replace(/\(/g,""),0===l.search(o)){let o=l.split("/");for(let l=0;l<i;l++)o.shift();if(1==o.length&&""!=o[0]){let l=a.getIcon(o[0]);s(".aws_file_list ul").append('<li class="aws_file_name" fileref="'+a.fileUrl+e+o[0]+'"><a href="#">'+l+" "+o[0]+"</a></li>"),t++}}}),0==t&&s(".aws_file_list ul").html("<li><h3>File Not Found</h3></li>")}getIcon(l){let e,i=l.split("."),s=i.length;return e=["mp3","wav","aiff","aac","ogg","wma","flac","alac","wma"].includes(i[s-1])&&'<span class="dashicons dashicons-format-audio"></span>',0==e&&(e=["jpg","gif","jpeg","png","svg","psd","bat","bmp","jfif","webp"].includes(i[s-1])&&'<span class="dashicons dashicons-format-image"></span>'),0==e&&(e=["mp4","mov","wmv","flv","avi","webm","mkv"].includes(i[s-1])&&'<span class="dashicons dashicons-format-video"></span>'),0==e&&(e=["js","html","css","sass","php"].includes(i[s-1])&&'<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 511.997 511.997" style="enable-background:new 0 0 511.997 511.997;" xml:space="preserve"> <g> <g> <path d="M506.76,242.828l-118.4-125.44c-7.277-7.718-19.424-8.07-27.142-0.787c-7.706,7.277-8.064,19.43-0.781,27.142 l105.965,112.256L360.437,368.268c-7.283,7.712-6.925,19.859,0.781,27.142c3.712,3.501,8.454,5.235,13.178,5.235 c5.101,0,10.195-2.022,13.965-6.01l118.4-125.446C513.742,261.785,513.742,250.226,506.76,242.828z"/> </g> </g> <g> <g> <path d="M151.566,368.262L45.608,255.999l105.958-112.262c7.277-7.712,6.925-19.866-0.787-27.142 c-7.706-7.277-19.866-6.925-27.142,0.787l-118.4,125.44c-6.982,7.398-6.982,18.963,0,26.362L123.643,394.63 c3.776,4,8.864,6.016,13.965,6.016c4.723,0,9.466-1.741,13.171-5.242C158.498,388.127,158.843,375.974,151.566,368.262z"/> </g> </g> <g> <g> <path d="M287.061,52.697c-10.477-1.587-20.282,5.606-21.882,16.083l-56.32,368.64c-1.6,10.483,5.6,20.282,16.083,21.882 c0.986,0.147,1.958,0.218,2.925,0.218c9.325,0,17.504-6.803,18.957-16.301l56.32-368.64 C304.744,64.095,297.544,54.297,287.061,52.697z"/> </g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg>'),0==e&&(e='<span class="dashicons dashicons-media-default"></span>'),e}getOpener(l){let e,i=l.split("."),s=i.length;return e=["mp3","wav","aiff","aac","ogg","wma","flac","alac","wma"].includes(i[s-1])&&"audio",0==e&&(e=["jpg","gif","jpeg","png","svg","psd","bat","bmp","jfif","webp"].includes(i[s-1])&&"image"),0==e&&(e=["mp4","mov","wmv","flv","avi","webm","mkv"].includes(i[s-1])&&"video"),0==e&&(e=["js","html","css","sass","php"].includes(i[s-1])&&"code"),0==e&&(e="undefined"),e}getData(){return this.allFolderFiles}picker(l,e){let i=jQuery;this.setOn=e;let s=this;""==l?this.retriveData():i(l).on("click",function(l){l.preventDefault(),s.retriveData()})}pickerHTML(){let l=document.createElement("div");l.innerHTML='            <div class="bplugins_awss3_filemanager">                 <div class="aws_popup_overlay"></div>                 <div class="aws_loading">                    <img src="https://bplugins.com/wp-content/uploads/2019/10/loading-2.gif" alt="">                </div>                <div class="aws_file_manager_popup">                    <div class="close">x</div>                    <div class="aws_header">                        <h2>AWS S3 File Manager</h2>                    </div>                     <div class="aws_body">                        <div class="aws_folder_list">                            <a href="#" class="root_folder"><span class="dashicons dashicons-admin-home"></span> Root Directory</a>                            <ul class="root_folder_list"></ul>                        </div>                        <div class="aws_file_list">                            <ul></ul>                        </div>                    </div>                    <div class="aws_footer">                        <button>Select</button>                    </div>                </div>                <div class="preview_panel">                    <div class="preview_close">X</div>                    <div class="preview"></div>                </div>            </div>',document.body.appendChild(l)}}})();